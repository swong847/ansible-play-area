---
# tasks file for roles/gpfs34-upgrade

     - name: gpfs | setup repository
       template:
         dest: /etc/yum.repos.d/gpfs.repo
         src: gpfs-repo.j2

     - name: gpfs | install rpms
       yum:
         name: "{{ item }}"
         state: present
         disable_gpg_check: yes
       with_items:
       - gpfs.base-{{ gpfs_latest}}
       - gpfs.docs-{{ gpfs_latest}}
       - gpfs.gpl-{{ gpfs_latest}}
       - gpfs.msg.en_US-{{ gpfs_latest}}

     - name: gpfs | Upgrade rpms
       yum:
         name: "{{ item }}"
         state: latest
         disable_gpg_check: yes
       with_items:
       - gpfs.base
       - gpfs.docs
       - gpfs.gpl
       - gpfs.msg.en_US

     - name: gpfs | build kernel
       command: chdir=/usr/lpp/mmfs/src/ make "{{ item }}"
       with_items:
       - LINUX_DISTRIBUTION=REDHAT_AS_LINUX Autoconfig
       - World
       - InstallImages
#       - rpm
       ignore_errors: true

#     - name: gpfs | install kernel module
#       yum:
#         name: "{{ gpfs_kernel_rpm }}"
#         state: present

